<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Custom Email template content code starts -->
        <record id="custom_rating_ticket_request_email_template" model="mail.template">
            <field name="name">Helpdesk: Custom Ticket Rating Request</field>
            <field name="model_id" ref="Microaccess_Helpdesk.model_helpdesk_ticket"/>
            <field name="subject">Your Support Ticket Has Been Closed #{{ object.name}}</field>
            <field name="email_from">{{ (object.team_id.alias_email_from or object.company_id.email_formatted or object._rating_get_operator().email_formatted or user.email_formatted) }}</field>
            <field name="email_to">{{ (object.partner_email if not object.sudo().partner_id.email or object.sudo().partner_id.email != object.partner_email else '') }}</field>
            <field name="partner_to">{{ object.partner_id.id if object.sudo().partner_id.email and object.sudo().partner_id.email == object.partner_email else '' }}</field>
            <field name="description">Enable "customer ratings" feature on the helpdesk team</field>
            <field name="body_html" type="html">
            <div>
                <t t-set="access_token" t-value="object._rating_get_access_token()"/>
                <t t-set="partner" t-value="object._rating_get_partner()"/>
                <table border="0" cellpadding="0" cellspacing="0" style="width:100%; margin:0;">
                <tbody>
                    <tr><td valign="top" style="font-size: 14px;">
                        <t t-if="partner.name">
                            Dear <t t-out="partner.name or ''">Brandon Freeman</t>,<br/><br/>
                        </t>
                        <t t-else="">
                            Dear Customer,<br/><br/>
                        </t>

                        <p>We hope this message finds you well.</p>
                        <p>
                            This is to inform you that your support ticket
                            <strong>#<t t-out="object.name"/></strong>
                            has been successfully resolved and is now closed.
                        </p>
                        <p>
                            Ticket Created Date:
                                <t t-if="object.create_date">
                                    <t t-out="object.create_date.strftime('%d/%m/%Y')"/>
                                </t>
                                <t t-else=""></t>
                                <br/>
                            Ticket Closed Date:
                                <t t-if="object.close_date">
                                    <t t-out="object.close_date.strftime('%d/%m/%Y')"/>
                                </t>
                                <t t-else=""></t>
                                <br/>
                            Assigned To (Engineer Name):
                                <t t-out="', '.join(object.user_ids.mapped('name')) or ''"/>
                                <br/>
                            Nature of Problem:
                                <t t-out="', '.join(object.ticket_nature_problem.mapped('nature_problem')) or ''"/>
                                <br/>
                            Service Product:
                                <t t-out="object.product_service or ''"/>
                                <br/>
                        </p>
                        <p>
                            Thank you for giving us the opportunity to assist you üôè. We appreciate your trust in our services.
                        </p>
                        <p>
                            Please take a moment to rate our services related to this ticket.
                        </p> 
                       
                    </td></tr>
                    <tr><td style="text-align: center;">
                        <table border="0" cellpadding="0" cellspacing="0" summary="o_mail_notification" style="width:100%; margin: 32px 0px 32px 0px;">
                            <tr><td style="font-size: 16px; margin-bottom: 8px;">
                                <strong>We value your feedback! Please rate and share your thoughts</strong><br/>
                                <!-- <span style="text-color: #888888">(Click Here!)</span> -->
                            </td></tr>
                            <tr>
                                <td> 
                                    <!-- <a t-attf-href="/rate/{{ access_token }}/select">Click here to provide your feedback!</a> -->
                                    <a t-attf-href="/rate/{{ access_token }}/select"
                                        style="
                                                display: inline-block;
                                                padding: 12px 24px;
                                                background-color: #714B67;
                                                color: #ffffff !important;
                                                text-decoration: none;
                                                font-size: 14px;
                                                font-weight: 600;
                                                border-radius: 6px;
                                                line-height: 1.4;
                                        ">
                                            Click here to provide your feedback!
                                        </a>
                                </td>
                            </tr>
                            
                        </table>
                    </td></tr>
                    <!-- <tr><td valign="top" style="font-size: 14px;">
                        We appreciate your feedback. It helps us improve continuously.
                        <br/><br/><span style="margin: 0px 0px 0px 0px; font-size: 12px; opacity: 0.5; color: #454748;">This customer survey has been sent because your ticket has been moved to the stage <b t-out="object.stage_id.name or ''">In Progress</b>.</span>
                    </td></tr> -->
                </tbody>
                </table>
            </div>
            </field>
            <field name="lang">{{ object.partner_id.lang or object.user_id.lang or user.lang }}</field>
            <field name="auto_delete" eval="True"/>
        </record>
    </data>
</odoo>
